## Назначение проекта

Изначально - ознакомительный pet-проект. Сейчас - дописанный проект под тестовое задание.

## Что делает проект

- Зарегистрированный пользователь может создавать посты, получать один конкретный пост, получать список постов, изменять их, удалять, помечать выполненными. 
- Администратор может добавлять новых пользователей, читать посты всех пользователей.
- Реализована авторизация пользователя и аутентификация по JWT-токенам. Пароли храняться в виде хешей в БД.
- Реализованы тесты всех эндпоинтов.

## Описание разграничений прав доступа

В проекте используется всего 2 таблицы, users и posts.
Для пользователей предусмотрены 2 роли, пользователь и администратор.
Пользователь имеет доступ к своим постам, так же к удалению и изменению информации своего аккаунта.
Администратор имеет свои эндпоинты для:
 - регистрации нового пользователя
 - изменения роли пользователя
 - удаления пользователя
 - чтения постов пользователей

В общем случае проверку авторизации я вынес в Dependency Ingection.
DI возвращает в аргумент объект с которым нужно провести операцию, перед возвратом проверяет:
1) наличие и валидность токена
2) есть ли пользователь в базе данных
3) есть ли доступ к операции (админ или автор поста)
Например DI is_admin возвращает объект пользователя из БД, если он является администратором, либо возвращает соответствующий ответ с ошибкой.3) есть ли доступ к операции, например DI is_admin возвращает объект пользователя из БД, если он является администратором, либо возвращает соответствующий ответ с ошибкой.3) есть ли доступ к операции, например DI is_admin возвращает объект пользователя из БД, если он является администратором, либо возвращает соответствующий ответ с ошибкой.
DI PostsDep проверяет, пользователя и возвращает объект поста.

## Стек технологий:

FastAPI, Pydantic, pytest-asycnio, RESTapi, PostgreSQL, SQLAlchemy, SQLModel, oauth, jwt

P.S. Если нужно - перепишу запросы с ORM на SQL.

## Как развернуть проект на сервере Ubuntu


- Установите PostgreSQL

sudo apt install postgresql postgresql-contrib -y 

- Зайдите в пользователя Postgres

sudo -i -u postgres

- Создайте пользователя и задайте ему пароль

createuser {username} --pwprompt

- Создайте БД

creatdb {db_name} --owner={username}

- Включите сервис PostgreSQL

sudo systemctl enable postgresql

- Создайте пользователя под которым будет запущен проект

sudo adduser fastapi
sudo -i -u fastapi

- Склонируйте репозиторий

git clone https://github.com/mark-ads/personal-posts

cd personal-posts

- Создайте файл настроек (настройки ниже)

nano src/.env

- Создайте виртуальное окружение

python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt

- Запустите проект из виртуального окружения

nohup fastapi run src/main.py --reload --host 0.0.0.0 --port 8000 &

## Поля в .env

- DB_HOST=localhost
- DB_PORT=5432
- DB_USER=username # логин от пользователя Postrgres
- DB_PASS=password # # пароль от пользователя Postrgres
- DB_NAME=posts # название БД
- TOKEN_KEY=anykey # ключ подписи JWT
- ADMIN_PASS=adminpass # пароль администратора проекта
- DROP_TABLE=true # true при первом запуске, затем false
